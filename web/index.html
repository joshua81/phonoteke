<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="css/bootstrap.min.css" rel="stylesheet">
  	<link href="css/phonotheque.css" rel="stylesheet">
  	<link href="css/spinner.css" rel="stylesheet">
  	<title>Phonotheque</title>
  </head>

  <body onload="loadAlbums(page)">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/album.js"></script>
    <script src="js/artist.js"></script>
    <script src="js/document.js"></script>

    <div class="header">
      <ul class="header">
        <li id="search" class"header"><a class="header" href="javascript:toggleSearch()"><span class="glyphicon glyphicon-search" aria-hidden="true"/></a></li>
        <li id="albums" class="header"><a class="header" href="javascript:loadStatus('albums')">Album</a></li>
        <li id="artists" class"header"><a class="header" href="javascript:loadStatus('artists')">Artisti</a></li>
        <!--li id="interviews" class="header"><a href="javascript:loadStatus('interviews')">Interviste</a></li-->
        <!--li id="concerts" class"four"><a href="javascript:loadStatus('concerts')">Concerti</a></li-->
        <!--li id="news"><a href="javascript:loadStatus('news')">News</a></li-->
      </ul>
      <input id="searchInput" type="text" class="form-control hidden" placeholder="Cerca" onkeypress="keyPressHandler(event)"/>
    </div>

    <div id="content" class="container"/>
    <div id="loader" class="throbber-loader hidden"/>
  </body>
</html>

<script>
var currentStatus = null;
var page = 0;

$(window).scroll(function()
{
    if(currentStatus == 'album' || currentStatus == 'artist')
    {
      return;
    }

    if(currentStatus == 'albums' && $(window).scrollTop() == $(document).height() - $(window).height())
    {
      page++;
      loadAlbums(page);
    }
    else if(currentStatus == 'artists' && $(window).scrollTop() == $(document).height() - $(window).height())
    {
      page++;
      loadArtists(page);
    }
});

window.onpopstate = function (event) {
  if(event.state) {
    currentStatus = event.state.status;
    content.innerHTML = event.state.content;
  }
}

function back() {
  window.history.back();
}

function loadStatus(status) {
  currentStatus = status;
  content.innerHTML = null;
  searchInput.value = null;
  page = 0;

  if(currentStatus == "albums")
  {
    loadAlbums(page);
  }
  else if(currentStatus == "artists")
  {
    loadArtists(page);
  }
  else if(currentStatus == "interviews")
  {
    loadInterviews(page);
  }
  else if(currentStatus == "concerts")
  {
    loadConcerts(page);
  }
  else if(currentStatus == "news")
  {
    loadNews(page);
  }
}

function toggleSearch() {
  searchInput.value = null;
  if(searchInput.classList.contains("hidden"))
  {
    searchInput.classList.remove("hidden");
    searchInput.classList.add("visible");
  }
  else
  {
    searchInput.classList.remove("visible");
    searchInput.classList.add("hidden");
  }
}

function keyPressHandler(e) {
	var key = e.keyCode || e.which;
	if (key == 13)
	{
		var text = searchInput.value;
		var req = new XMLHttpRequest();
		req.onreadystatechange = function() {
			if (req.readyState == 4 && req.status == 200) {
				var res = JSON.parse(req.responseText);
				searchHandler(res);
			}
		}

    page = 0;
    content.innerHTML = null;
    if(currentStatus == 'album' || currentStatus == 'albums')
    {
      loadAlbums(page);
    }
    else if(currentStatus == 'artist' || currentStatus == 'artists')
    {
      loadArtists(page);
    }
	}
}

// INTERVIEWS
function loadInterviews(page) {
	currentStatus = 'interviews';
}

// CONCERTS
function loadConcerts(page) {
	currentStatus = 'concerts';
}

// NEWS
function loadNews(page) {
	currentStatus = 'news';
}
</script>
